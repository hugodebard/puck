import { ConfigPreview } from "@/docs/components/Preview";

# External

Select data from a list, typically populated via a third-party API. Extends [Base](base).

```tsx {5-16} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            // ... fetch data from a third party API, or other async source

            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
        },
      },
      render: ({ data }) => {
        return <p>{data?.title || "No data selected"}</p>;
      },
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Hello, world", description: "Lorem ipsum 1" },
            { title: "Goodbye, world", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },
  }}
/>

## Params

| Param                                     | Example                                      | Type       | Status   |
| ----------------------------------------- | -------------------------------------------- | ---------- | -------- |
| [`type`](#type)                           | `type: "external"`                           | "external" | Required |
| [`fetchList()`](#fetchlistqueryparams)    | `fetchList: async () => []`                  | Function   | Required |
| [`cache`](#cache)                         | `cache: { enabled: true }`                   | Object     | -        |
| [`filterFields`](#filterfields)           | `{ "rating": { type: "number" } }`           | Object     | -        |
| [`getItemSummary()`](#getitemsummaryitem) | `getItemSummary: async ({ title }) => title` | Function   | -        |
| [`initialFilters`](#initialfilters)       | `{ "rating": 1 }`                            | Object     | -        |
| [`initialQuery`](#initialquery)           | `initialQuery: "Hello, world"`               | String     | -        |
| [`mapProp()`](#mappropitem)               | `mapProp: async ({ title }) => title`        | Function   | -        |
| [`mapRow()`](#maprowitem)                 | `mapRow: async ({ title }) => title`         | Function   | -        |
| [`pagination`](#pagination)               | `pagination: { enabled: true }`              | Object     | -        |
| [`placeholder`](#placeholder)             | `placeholder: "Select content"`              | String     | -        |
| [`renderFooter()`](#renderfooterprops)    | `renderFooter: (props) => <p>Hello</p>`      | Function   | -        |
| [`showSearch`](#showsearch)               | `showSearch: true`                           | Boolean    | -        |
| [`sortableColumns`](#sortablecolumns)     | `sortableColumns: ["title", "date"]`         | String[]   | -        |

## Required params

### `type`

The type of the field. Must be `"external"` for Array fields.

```tsx {6} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
        },
      },
      // ...
    },
  },
};
```

### `fetchList(queryParams)`

Return a promise with an object containing `items` (an array of objects to be rendered in a tabular format).

The table will only render strings and numbers.

```tsx {7-15} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            // ... fetch data from a third party API, or other async source

            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
        },
      },
      // ...
    },
  },
};
```

#### `queryParams`

The parameters passed to the `fetchList` method based on your field configuration.

| Param                 | Example                                 | Type   |
| --------------------- | --------------------------------------- | ------ |
| [`query`](#query)     | `"My Query"`                            | String |
| [`filters`](#filters) | `"{ "rating": 1 }"`                     | Object |
| [`page`](#page)       | `1`                                     | Number |
| [`limit`](#limit)     | `10`                                    | Number |
| [`sort`](#sort)       | `{ column: "title", direction: "asc" }` | Object |

##### `query`

The search query when using [`showSearch`](#showsearch).

##### `filters`

An object describing the filters configured by [`filterFields`](#filterfields).

##### `page`

The current page number (1-indexed). Only provided when pagination is enabled.

##### `limit`

The number of items per page. Only provided when pagination is enabled.

##### `sort`

An object describing the current sort state with `column` (string) and `direction` ("asc" | "desc"). Only provided when a sortable column is actively sorted.

## Optional params

### `cache`

Puck will automatically cache the output of the [`fetchList()`](#fetchlistqueryparams) function in memory.

You can disable this behaviour by setting `cache: { enabled: false }` on your field.

```tsx {7} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          cache: { enabled: true },
          fetchList: async () => {
            // ... fetch data from a third party API, or other async source

            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
        },
      },
      // ...
    },
  },
};
```

### `filterFields`

An object describing filters for your query using the [Fields API](/docs/api-reference/fields)

```tsx {14-18} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async ({ filters }) => {
            const items = [
              { title: "Apple", description: "Lorem ipsum 1", rating: 5 },
              { title: "Orange", description: "Lorem ipsum 2", rating: 3 },
            ].filter((item) => item.rating >= (filters.rating || 0));
            return { items };
          },
          filterFields: {
            rating: {
              type: "number",
            },
          },
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async ({ filters }) => {
          const items = [
            { title: "Apple", description: "Lorem ipsum 1", rating: 5 },
            { title: "Orange", description: "Lorem ipsum 2", rating: 3 },
          ].filter((item) =>
            item.rating >= (filters.rating || 0)
          );
          return { items };
        },
        filterFields: {
          rating: {
            type: "number",
          },
        },
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

### `getItemSummary(item)`

Get the label to show once the item is selected.

```tsx {14} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
          getItemSummary: (item) => item.title,
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Hello, world", description: "Lorem ipsum 1" },
            { title: "Goodbye, world", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
        getItemSummary: (item) => item.title,
      },
    },
    defaultProps: {
      data: {
        title: "Hello, world",
        description: "Lorem ipsum 1",
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },
  }}
/>

### `initialFilters`

The initial filter values when using [`filterFields`](#filterfields).

```tsx {27-29} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async ({ filters }) => {
            const items = [
              {
                title: "Hello, world",
                description: "Lorem ipsum 1",
                rating: 5,
              },
              {
                title: "Goodbye, world",
                description: "Lorem ipsum 2",
                rating: 2,
              },
            ].filter((item) => item.rating >= (filters.rating || 0));
            return { items };
          },
          filterFields: {
            rating: {
              type: "number",
            },
          },
          initialFilters: {
            rating: 1,
          },
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async ({ filters }) => {
          const items = [
              {
                title: "Hello, world",
                description: "Lorem ipsum 1",
                rating: 5,
              },
              {
                title: "Goodbye, world",
                description: "Lorem ipsum 2",
                rating: 2,
              },
            ].filter((item) => item.rating >= (filters.rating || 0));
            return { items };
        },
        filterFields: {
          rating: {
            type: "number",
          },
        },
        initialFilters: {
          rating: 1,
        },
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

### `initialQuery`

Set an initial query when using showing a search input with [`showSearch`](#showsearch).

```tsx {8} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          showSearch: true,
          initialQuery: "Apple",
          fetchList: async ({ query }) => {
            const items = [
              { title: "Apple", description: "Lorem ipsum 1" },
              { title: "Orange", description: "Lorem ipsum 2" },
            ].filter((item) => {
              // ...
            });
            return { items };
          },
        },
      },
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        showSearch: true,
        initialQuery: "apple",
        fetchList: async ({ query }) => {
          const items = [
            {
              title: "Apple",
              description: "An apple is a round, edible fruit produced by an apple tree.",
            },
            {
              title: "Orange",
              description: "An orange is a fruit of various citrus species in the family Rutaceae.",
            },
          ].filter((item) => {
            if (!query) return true;

            const queryLowercase = query.toLowerCase();
            return (
              item.title.toLowerCase().includes(queryLowercase) ||
              item.description.toLowerCase().includes(queryLowercase)
            );
          });
          return { items };
        },
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

### `mapProp(item)`

Modify the shape of the item selected by the user in the table before writing to the page data.

```tsx {14} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
          mapProp: (item) => item.description,
        },
      },
      render: ({ data }) => {
        return <p>{data || "No data selected"}</p>;
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Hello, world", description: "Lorem ipsum 1" },
            { title: "Goodbye, world", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
        mapProp: (item) => item.description,
      },
    },
    render: ({ data }) => {
      return <p>{data || "No data selected"}</p>;
    },
  }}
/>

### `mapRow(item)`

Modify the shape of the item before rendering it in the table. This will not affect the selected data.

```tsx {14} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
          mapRow: (item) => ({ ...item, title: item.title.toUpperCase() }),
        },
      },
      render: ({ data }) => {
        return <p>{data || "No data selected"}</p>;
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Hello, world", description: "Lorem ipsum 1" },
            { title: "Goodbye, world", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
        mapRow: (item) => ({ ...item, title: item.title.toUpperCase() }),
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },
  }}
/>

### `placeholder`

Set the placeholder text when no item is selected.

```tsx {14} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Apple", description: "Lorem ipsum 1" },
              { title: "Orange", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
          placeholder: "Pick your favorite fruit",
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Apple", description: "Lorem ipsum 1" },
            { title: "Orange", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
        placeholder: "Pick your favorite fruit",
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },
  }}
/>

### `renderFooter(props)`

Customize what will be displayed in the footer of the modal.

```tsx {14-16} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async () => {
            const items = [
              { title: "Hello, world", description: "Lorem ipsum 1" },
              { title: "Goodbye, world", description: "Lorem ipsum 2" },
            ];
            return { items };
          },
          renderFooter: ({ items }) => (
            <b>Custom footer with {items.length} results</b>
          ),
        },
      },
      render: ({ data }) => {
        return <p>{data || "No data selected"}</p>;
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async () => {
          const items = [
            { title: "Hello, world", description: "Lorem ipsum 1" },
            { title: "Goodbye, world", description: "Lorem ipsum 2" },
          ];
          return { items };
        },
        renderFooter: ({ items }) => (
          <b>Custom footer with {items.length} results</b>
        ),
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },
  }}
/>

### `pagination`

Configure server-side pagination for the external data list. When enabled, the `fetchList` function will receive `page` and `limit` parameters, and your server/API should handle pagination logic.

Use `pagination.initialPage` and `pagination.initialPageSize` to set the initial page and page size. If these are not set, the default parameters in your `fetchList` function signature will be used.

```tsx {14-20} {22-27} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async ({ query, page = 1, limit = 10 }) => {
            const items = [
              { title: "Item 1", description: "Lorem ipsum 1" },
              { title: "Item 2", description: "Lorem ipsum 2" },
              { title: "Item 3", description: "Lorem ipsum 3" },
              // ... more items
            ];
            const startIndex = (page - 1) * limit;
            const endIndex = startIndex + limit;
            const paginatedItems = items.slice(startIndex, endIndex);
            return {
              items: paginatedItems,
              total: totalItems,
            };
          },
          pagination: {
            enabled: true,
            pageSizeOptions: [5, 10, 25],
            initialPage: 1,
            initialPageSize: 10,
          },
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async ({ page = 1, limit = 3 }) => {
          const items = Array.from({ length: 100 }, (_, i) => ({
            title: `Item ${i + 1}`,
            description: `Lorem ipsum ${i + 1}`,
          }));
          const totalItems = items.length;
          const startIndex = (page - 1) * limit;
          const endIndex = startIndex + limit;
          const paginatedItems = items.slice(startIndex, endIndex);
          return {
            items: paginatedItems,
            total: totalItems,
          };
        },
        pagination: {
          enabled: true,
          pageSizeOptions: [5, 10, 25],
          initialPage: 1,
          initialPageSize: 10,
        },
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

#### Pagination params

| Param                                   | Example                        | Type     | Status |
| --------------------------------------- | ------------------------------ | -------- | ------ |
| [`enabled`](#enabled)                   | `enabled: true`                | Boolean  | -      |
| [`pageSizeOptions`](#pagesizeoptions)   | `pageSizeOptions: [5, 10, 25]` | Number[] | -      |
| [`initialPage`](#initialpage-1)         | `initialPage: 1`               | Number   | -      |
| [`initialPageSize`](#initialpagesize-1) | `initialPageSize: 10`          | Number   | -      |

##### `enabled`

Enable or disable server-side pagination. When enabled, `fetchList` will receive `page` and `limit` parameters. Defaults to `false`.

##### `pageSizeOptions`

An array of page size options for the user to choose from. Defaults to `[10, 25, 50]`.

##### `initialPage`

The initial page number (1-indexed) to display when the modal opens. If not set, the default parameter value from your `fetchList` function will be used (typically `1`).

##### `initialPageSize`

The initial number of items per page to display when the modal opens. If not set, the default parameter value from your `fetchList` function will be used (typically `10`).

### `showSearch`

Show a search input, the value of which will be passed to `fetchList` as the `query` param.

```tsx {17} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external"
          cache: { enabled: false }
          fetchList: async ({ query }) => {
            const items = [
              { title: "Apple", description: "Lorem ipsum 1" },
              { title: "Orange", description: "Lorem ipsum 2" },
            ].filter((item) => {
              // ...
            });
            return { items };
          },
          showSearch: true,
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        fetchList: async ({ query }) => {
          const items = [
            {
              title: "Apple",
              description:
                "An apple is a round, edible fruit produced by an apple tree.",
            },
            {
              title: "Orange",
              description:
                "An orange is a fruit of various citrus species in the family Rutaceae.",
            },
          ].filter((item) => {
            if (!query) return item;

            const queryLowercase = query.toLowerCase();

            if (item.title.toLowerCase().indexOf(queryLowercase) > -1) {
              return item;
            }

            if (item.description.toLowerCase().indexOf(queryLowercase) > -1) {
              return item;
            }
          });
          return { items };
        },
        showSearch: true,
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

### `sortableColumns`

An array of column keys that can be sorted by the user. When a sortable column is clicked, `fetchList` will receive a `sort` parameter with `{ column: string, direction: "asc" | "desc" }`. Your server/API should handle the sorting logic.

```tsx {13-20} {23} copy
const config = {
  components: {
    Example: {
      fields: {
        data: {
          type: "external",
          fetchList: async ({ sort }) => {
            const items = [
              { title: "Banana", rating: 3, date: "2024-01-01" },
              { title: "Apple", rating: 5, date: "2024-02-15" },
              { title: "Orange", rating: 4, date: "2024-03-20" },
            ];
            if (sort) {
              items.sort((a, b) => {
                const aVal = a[sort.column];
                const bVal = b[sort.column];
                const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                return sort.direction === "asc" ? comparison : -comparison;
              });
            }
            return { items };
          },
          sortableColumns: ["title", "date"],
        },
      },
      // ...
    },
  },
};
```

<ConfigPreview
  label="Example"
  componentConfig={{
    fields: {
      data: {
        type: "external",
        cache: { enabled: false },
        pagination: {
              enabled: false,
        },
        fetchList: async ({ sort }) => {
          const items = [
            { title: "Banana", rating: 3, date: "2024-01-01" },
            { title: "Apple", rating: 5, date: "2024-02-15" },
            { title: "Orange", rating: 4, date: "2024-03-20" },
          ];

          if (sort) {
            items.sort((a, b) => {
              const aVal = a[sort.column];
              const bVal = b[sort.column];
              const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
              return sort.direction === "asc" ? comparison : -comparison;
            });
          }

          return { items };
        },
        sortableColumns: ["title", "date"],
      },
    },
    render: ({ data }) => {
      return <p>{data?.title || "No data selected"}</p>;
    },

}}
/>

<div id="puck-portal-root" />
